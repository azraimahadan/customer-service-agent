(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8080:function(e,t,s){Promise.resolve().then(s.bind(s,634))},634:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ChatContainer}});var a=s(7437),r=s(2265),i=s(2601);let n=i.env.NEXT_PUBLIC_API_URL||"https://your-api-gateway-url.amazonaws.com/prod";let ApiClient=class ApiClient{static async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s=await fetch("".concat(n).concat(e),{headers:{"Content-Type":"application/json",...t.headers},...t});if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));let a=await s.json();return{data:a}}catch(e){return{error:e instanceof Error?e.message:"Unknown error"}}}static async uploadFiles(e,t,s){let a={};if(e){let t=await this.fileToBase64(e);a.image=t.split(",")[1]}if(t){let e=await this.blobToBase64(t);a.audio=e.split(",")[1]}return s&&(a.text=s),this.makeRequest("/upload",{method:"POST",body:JSON.stringify(a)})}static async transcribeAudio(e){return this.makeRequest("/transcribe",{method:"POST",body:JSON.stringify({session_id:e})})}static async analyzeImage(e){return this.makeRequest("/analyze-image",{method:"POST",body:JSON.stringify({session_id:e})})}static async troubleshoot(e){return this.makeRequest("/troubleshoot",{method:"POST",body:JSON.stringify({session_id:e})})}static async executeAction(e,t){return this.makeRequest("/execute-action",{method:"POST",body:JSON.stringify({session_id:e,action:t})})}static fileToBase64(e){return new Promise((t,s)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>s(e)})}static blobToBase64(e){return new Promise((t,s)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>s(e)})}};var o=s(7972),l=s(3966),c=s(1243),d=s(6691),u=s.n(d),m=s(7393);function ChatMessage(e){let{message:t,onActionClick:s}=e,i="user"===t.sender,n=(0,r.useRef)(null),d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(t.audioResponse&&n.current&&!i){let playAudio=async()=>{try{var e;await (null===(e=n.current)||void 0===e?void 0:e.play())}catch(e){console.log("Auto-play failed (user interaction required):",e)}};playAudio()}},[t.audioResponse,i]),(0,a.jsxs)("div",{className:"flex gap-3 ".concat(i?"flex-row-reverse":"flex-row"," mb-6 message-enter message-enter-active"),children:[(0,a.jsx)("div",{className:i?"avatar":"avatar-bot",children:i?(0,a.jsx)(o.Z,{size:18}):(0,a.jsx)(l.Z,{size:18})}),(0,a.jsxs)("div",{className:"chat-bubble ".concat(i?"chat-bubble-user":"chat-bubble-bot"),children:["text"===t.type&&(0,a.jsx)("div",{className:"prose prose-sm max-w-none text-base leading-relaxed font-medium",children:(0,a.jsx)(m.UG,{components:{p:e=>{let{children:t}=e;return(0,a.jsx)("p",{className:"mb-2 last:mb-0",children:t})},strong:e=>{let{children:t}=e;return(0,a.jsx)("strong",{className:"font-bold text-gray-900",children:t})},em:e=>{let{children:t}=e;return(0,a.jsx)("em",{className:"italic text-gray-800",children:t})},ul:e=>{let{children:t}=e;return(0,a.jsx)("ul",{className:"list-disc ml-4 mb-2",children:t})},ol:e=>{let{children:t}=e;return(0,a.jsx)("ol",{className:"list-decimal ml-4 mb-2",children:t})},li:e=>{let{children:t}=e;return(0,a.jsx)("li",{className:"mb-1",children:t})}},children:t.content})}),"image"===t.type&&t.imageUrl&&(0,a.jsxs)("div",{children:[(0,a.jsx)(u(),{src:t.imageUrl,alt:"Uploaded image",width:240,height:240,className:"rounded-ios mb-3 shadow-ios-md border border-surface-200"}),t.content&&(0,a.jsx)("p",{className:"text-base leading-relaxed font-medium",children:t.content})]}),"audio"===t.type&&t.audioUrl&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-10 h-10 bg-primary-50 rounded-full",children:(0,a.jsx)(c.Z,{size:16,className:"text-primary-600"})}),(0,a.jsx)("audio",{ref:d,controls:!0,className:"flex-1 h-8",children:(0,a.jsx)("source",{src:t.audioUrl,type:"audio/wav"})})]}),t.audioResponse&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-surface-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(c.Z,{size:14,className:"text-secondary-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Audio Response"})]}),(0,a.jsxs)("audio",{ref:n,controls:!0,className:"w-full h-8",preload:"metadata",crossOrigin:"anonymous",children:[(0,a.jsx)("source",{src:t.audioResponse,type:"audio/mpeg"}),"Your browser does not support the audio element."]})]}),t.actions&&t.actions.length>0&&(0,a.jsxs)("div",{className:"mt-4 pt-3 border-t border-surface-200",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-text-secondary mb-2",children:"Suggested Actions:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t.actions.map((e,t)=>(0,a.jsx)("button",{onClick:()=>null==s?void 0:s(e),className:"btn-secondary text-xs px-3 py-1.5 hover:bg-primary-50 hover:text-primary-700 transition-colors",children:e},t))})]}),(0,a.jsx)("div",{className:"text-xs mt-2 font-medium ".concat(i?"text-white/80":"text-text-muted"),children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}var x=s(2549),h=s(4035),p=s(7803),g=s(4043),b=s(6020);function ChatInput(e){let{onSendMessage:t,isLoading:s,isRecording:i,recordedAudio:n,onStartRecording:o,onStopRecording:l,onClearRecordedAudio:c}=e,[d,u]=(0,r.useState)(""),[m,f]=(0,r.useState)(null),[y,v]=(0,r.useState)(null),j=(0,r.useRef)(null),handleSubmit=e=>{e.preventDefault(),(d.trim()||m||n)&&(n?(t(d||"Audio message describing the issue","audio",n),c()):m?(t(d,"image",m),f(null),v(null)):t(d,"text"),u(""))};return(0,a.jsxs)("div",{className:"p-6",children:[y&&(0,a.jsxs)("div",{className:"mb-4 relative inline-block",children:[(0,a.jsx)("img",{src:y,alt:"Preview",className:"max-w-24 max-h-24 rounded-ios shadow-ios-md border border-surface-200"}),(0,a.jsx)("button",{onClick:()=>{f(null),v(null),j.current&&(j.current.value="")},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-ios active:scale-95 transition-all",children:(0,a.jsx)(x.Z,{size:12})})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"flex gap-3 items-end",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),placeholder:"Ask about your issue...",className:"input-field resize-none min-h-[44px] max-h-32",rows:1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleSubmit(e))}})}),(0,a.jsx)("input",{ref:j,type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){f(s);let e=new FileReader;e.onload=e=>{var t;return v(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(s)}},className:"hidden"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},className:"btn-icon",disabled:s,children:(0,a.jsx)(h.Z,{size:20})}),(0,a.jsx)("button",{type:"button",onClick:i?l:o,className:"btn-icon ".concat(i?"bg-red-50 text-red-600 border-red-200 animate-pulse":""),disabled:s,children:i?(0,a.jsx)(p.Z,{size:20}):(0,a.jsx)(g.Z,{size:20})}),(0,a.jsx)("button",{type:"submit",disabled:s||!d.trim()&&!m&&!n,className:"btn-primary",children:(0,a.jsx)(b.Z,{size:20})})]})]})}var f=s(3539),y=s(6264);function ChatContainer(){let[e,t]=(0,r.useState)([{id:"1",content:"Hello! I'm SUARA, your customer service assistant brought to you by Team Codezilla. How can I assist you today?",sender:"bot",timestamp:new Date,type:"text"}]),[s,i]=(0,r.useState)(!1),[n,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),m=(0,r.useRef)(null),x=(0,r.useRef)(null),h=(0,r.useRef)([]),scrollToBottom=()=>{var e;null===(e=m.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{scrollToBottom()},[e]);let[p,g]=(0,r.useState)(""),executeAction=async e=>{if(!d){console.error("No session ID available for action execution");return}i(!0),g("Executing action...");try{var s;let a=await ApiClient.executeAction(d,e);if(a.error)throw Error(a.error);let r={id:Date.now().toString(),content:'Action "'.concat(e,'" executed successfully. ').concat((null===(s=a.data)||void 0===s?void 0:s.message)||""),sender:"bot",timestamp:new Date,type:"text"};t(e=>[...e,r])}catch(a){console.error("Action execution error:",a);let s={id:Date.now().toString(),content:'Failed to execute action "'.concat(e,'": ').concat(a instanceof Error?a.message:"Unknown error"),sender:"bot",timestamp:new Date,type:"text"};t(e=>[...e,s])}finally{i(!1),g("")}},processWithBackend=async(e,s,a)=>{try{let r=1,i=(a?1:0)+(s?1:0)+1,n=!0,o=!0;if(a){g("Step ".concat(r,"/").concat(i,": Transcribing audio..."));let t=await ApiClient.transcribeAudio(e);t.error&&(console.warn("Transcription failed: ".concat(t.error)),n=!1),r++}if(s){g("Step ".concat(r,"/").concat(i,": Analyzing image..."));let t=await ApiClient.analyzeImage(e);t.error&&(console.warn("Image analysis failed: ".concat(t.error)),o=!1),r++}if((!a||n)&&(!s||o)){g("Step ".concat(r,"/").concat(i,": Generating solution..."));let s=await ApiClient.troubleshoot(e);if(s.error)throw Error("Troubleshooting failed: ".concat(s.error));let a=s.data,n={id:(Date.now()+1).toString(),content:a.response,sender:"bot",timestamp:new Date,type:"text",audioResponse:a.audio_url,sessionId:a.session_id,actions:a.actions};t(e=>[...e,n])}else throw Error("Failed to process uploaded files. Please try again.");g("")}catch(s){console.error("Backend processing error:",s),g("");let e={id:(Date.now()+1).toString(),content:"I encountered an error: ".concat(s instanceof Error?s.message:"Unknown error",". Please try again or contact support."),sender:"bot",timestamp:new Date,type:"text"};t(t=>[...t,e])}},handleSendMessage=async(e,s,a)=>{let r={id:Date.now().toString(),content:e,sender:"user",timestamp:new Date,type:s,imageUrl:a&&"image"===s?URL.createObjectURL(a):void 0,audioUrl:a&&"audio"===s?URL.createObjectURL(a):void 0};t(e=>[...e,r]),i(!0);try{let t;g("text"===s?"Processing message...":"Uploading files...");let r=await ApiClient.uploadFiles("image"===s?a:void 0,"audio"===s?a:void 0,"text"===s?e:void 0);if(r.error)throw Error("".concat("text"===s?"Session creation":"Upload"," failed: ").concat(r.error));t=r.data.session_id,u(t),await processWithBackend(t,"image"===s,"audio"===s)}catch(s){console.error("Error sending message:",s),g("");let e={id:(Date.now()+2).toString(),content:"Sorry, I encountered an error: ".concat(s instanceof Error?s.message:"Unknown error",". Please try again."),sender:"bot",timestamp:new Date,type:"text"};t(t=>[...t,e])}finally{i(!1),g("")}},startRecording=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);x.current=t,h.current=[],t.ondataavailable=e=>{h.current.push(e.data)},t.onstop=()=>{let t=new Blob(h.current,{type:"audio/wav"});URL.createObjectURL(t),setTimeout(()=>{handleSendMessage("Audio message describing the issue","audio",t),c(null)},100),e.getTracks().forEach(e=>e.stop())},t.start(),o(!0)}catch(e){console.error("Error starting recording:",e)}};return(0,a.jsxs)("div",{className:"flex flex-col h-screen max-w-4xl mx-auto bg-surface shadow-ios-xl rounded-ios-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"header-gradient text-white p-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center shadow-ios backdrop-blur-ios",children:(0,a.jsx)(f.Z,{size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold tracking-tight",children:"SUARA"}),(0,a.jsx)("p",{className:"text-sm opacity-90 font-medium",children:"AI-Powered Customer Service"})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-background custom-scrollbar",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[e.map(e=>(0,a.jsx)(ChatMessage,{message:e,onActionClick:executeAction},e.id)),s&&(0,a.jsxs)("div",{className:"flex gap-3 mb-6 message-enter message-enter-active",children:[(0,a.jsx)("div",{className:"avatar-bot",children:(0,a.jsx)(y.Z,{size:16,className:"animate-spin text-primary-600"})}),(0,a.jsx)("div",{className:"chat-bubble chat-bubble-bot",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"typing-indicator",children:[(0,a.jsx)("div",{className:"typing-dot"}),(0,a.jsx)("div",{className:"typing-dot"}),(0,a.jsx)("div",{className:"typing-dot"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary font-medium",children:p||"Analyzing your issue..."}),p&&(0,a.jsx)("div",{className:"mt-2 w-32 bg-surface-200 rounded-full h-1.5",children:(0,a.jsx)("div",{className:"bg-primary-500 h-1.5 rounded-full animate-pulse",style:{width:"60%"}})})]})]})})]})]}),(0,a.jsx)("div",{ref:m})]}),(0,a.jsx)("div",{className:"border-t border-surface-200 bg-surface/50 backdrop-blur-ios",children:(0,a.jsx)(ChatInput,{onSendMessage:handleSendMessage,isLoading:s,isRecording:n,recordedAudio:l,onStartRecording:startRecording,onStopRecording:()=>{x.current&&n&&(x.current.stop(),o(!1))},onClearRecordedAudio:()=>c(null)})})]})}}},function(e){e.O(0,[393,971,472,744],function(){return e(e.s=8080)}),_N_E=e.O()}]);