(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8080:function(e,t,a){Promise.resolve().then(a.bind(a,634))},634:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ChatContainer}});var r=a(7437),s=a(2265),o=a(2601);let ApiClient=class ApiClient{static async uploadFiles(e,t){try{let a=new FormData;e&&a.append("image",e),t&&a.append("audio",t,"recording.wav");let r=await fetch("".concat(this.BASE_URL,"/api/upload"),{method:"POST",body:a});if(!r.ok)throw Error("Upload failed: ".concat(r.statusText));let s=await r.json();return{data:s}}catch(e){return console.error("Upload error:",e),{error:e instanceof Error?e.message:"Upload failed"}}}static async transcribeAudio(e){try{let t=await fetch("".concat(this.BASE_URL,"/api/transcribe"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})});if(!t.ok)throw Error("Transcription failed: ".concat(t.statusText));let a=await t.json();return{data:a}}catch(e){return console.error("Transcription error:",e),{error:e instanceof Error?e.message:"Transcription failed"}}}static async analyzeImage(e){try{let t=await fetch("".concat(this.BASE_URL,"/api/analyze-image"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})});if(!t.ok)throw Error("Image analysis failed: ".concat(t.statusText));let a=await t.json();return{data:a}}catch(e){return console.error("Image analysis error:",e),{error:e instanceof Error?e.message:"Image analysis failed"}}}static async troubleshoot(e){try{let t=await fetch("".concat(this.BASE_URL,"/api/troubleshoot"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})});if(!t.ok){let e="Troubleshooting failed: ".concat(t.statusText);try{let a=await t.json();a.error&&(e=a.error)}catch(e){}throw Error(e)}let a=await t.json();if(a.error&&a.error.includes("NoSuchKey"))return{error:"Required files are missing from storage. Please try uploading your image or audio again."};return{data:a}}catch(e){if(console.error("Troubleshooting error:",e),e instanceof Error){if(e.message.includes("NoSuchKey"))return{error:"Required files are missing from storage. Please try uploading your image or audio again."};return{error:e.message}}return{error:"Troubleshooting failed. Please try again."}}}static async executeAction(e,t){try{let a=await fetch("".concat(this.BASE_URL,"/api/execute-action"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e,action:t})});if(!a.ok){let e="Action execution failed: ".concat(a.statusText);try{let t=await a.json();t.error&&(e=t.error)}catch(e){}throw Error(e)}let r=await a.json();return{data:r}}catch(e){if(console.error("Action execution error:",e),e instanceof Error)return{error:e.message};return{error:"Action execution failed. Please try again."}}}};ApiClient.BASE_URL=o.env.NEXT_PUBLIC_API_URL||"http://localhost:8000";var i=a(7972),n=a(3966),c=a(1243),l=a(6691),d=a.n(l);function ChatMessage(e){let{message:t,onActionClick:a}=e,s="user"===t.sender;return(0,r.jsxs)("div",{className:"flex gap-3 ".concat(s?"flex-row-reverse":"flex-row"," mb-6 message-enter message-enter-active"),children:[(0,r.jsx)("div",{className:s?"avatar":"avatar-bot",children:s?(0,r.jsx)(i.Z,{size:18}):(0,r.jsx)(n.Z,{size:18})}),(0,r.jsxs)("div",{className:"chat-bubble ".concat(s?"chat-bubble-user":"chat-bubble-bot"),children:["text"===t.type&&(0,r.jsx)("p",{className:"text-base leading-relaxed font-medium",children:t.content}),"image"===t.type&&t.imageUrl&&(0,r.jsxs)("div",{children:[(0,r.jsx)(d(),{src:t.imageUrl,alt:"Uploaded image",width:240,height:240,className:"rounded-ios mb-3 shadow-ios-md border border-surface-200"}),t.content&&(0,r.jsx)("p",{className:"text-base leading-relaxed font-medium",children:t.content})]}),"audio"===t.type&&t.audioUrl&&(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-10 h-10 bg-primary-50 rounded-full",children:(0,r.jsx)(c.Z,{size:16,className:"text-primary-600"})}),(0,r.jsx)("audio",{controls:!0,className:"flex-1 h-8",children:(0,r.jsx)("source",{src:t.audioUrl,type:"audio/wav"})})]}),t.audioResponse&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-surface-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(c.Z,{size:14,className:"text-secondary-500"}),(0,r.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Audio Response"})]}),(0,r.jsx)("audio",{controls:!0,className:"w-full h-8",children:(0,r.jsx)("source",{src:t.audioResponse,type:"audio/mpeg"})})]}),t.actions&&t.actions.length>0&&(0,r.jsxs)("div",{className:"mt-4 pt-3 border-t border-surface-200",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-text-secondary mb-2",children:"Suggested Actions:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:t.actions.map((e,t)=>(0,r.jsx)("button",{onClick:()=>null==a?void 0:a(e),className:"btn-secondary text-xs px-3 py-1.5 hover:bg-primary-50 hover:text-primary-700 transition-colors",children:e},t))})]}),(0,r.jsx)("div",{className:"text-xs mt-2 font-medium ".concat(s?"text-white/80":"text-text-muted"),children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}var u=a(2549),m=a(4035),h=a(7803),x=a(4043),p=a(6020);function ChatInput(e){let{onSendMessage:t,isLoading:a,isRecording:o,onStartRecording:i,onStopRecording:n}=e,[c,l]=(0,s.useState)(""),[d,g]=(0,s.useState)(null),[f,b]=(0,s.useState)(null),y=(0,s.useRef)(null),handleSubmit=e=>{e.preventDefault(),(c.trim()||d)&&(d?(t(c,"image",d),g(null),b(null)):t(c,"text"),l(""))};return(0,r.jsxs)("div",{className:"p-6",children:[f&&(0,r.jsxs)("div",{className:"mb-4 relative inline-block",children:[(0,r.jsx)("img",{src:f,alt:"Preview",className:"max-w-24 max-h-24 rounded-ios shadow-ios-md border border-surface-200"}),(0,r.jsx)("button",{onClick:()=>{g(null),b(null),y.current&&(y.current.value="")},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-ios active:scale-95 transition-all",children:(0,r.jsx)(u.Z,{size:12})})]}),(0,r.jsxs)("form",{onSubmit:handleSubmit,className:"flex gap-3 items-end",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("textarea",{value:c,onChange:e=>l(e.target.value),placeholder:"Ask about your issue...",className:"input-field resize-none min-h-[44px] max-h-32",rows:1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleSubmit(e))}})}),(0,r.jsx)("input",{ref:y,type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){g(a);let e=new FileReader;e.onload=e=>{var t;return b(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(a)}},className:"hidden"}),(0,r.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=y.current)||void 0===e?void 0:e.click()},className:"btn-icon",disabled:a,children:(0,r.jsx)(m.Z,{size:20})}),(0,r.jsx)("button",{type:"button",onClick:o?n:i,className:"btn-icon ".concat(o?"bg-red-50 text-red-600 border-red-200 animate-pulse":""),disabled:a,children:o?(0,r.jsx)(h.Z,{size:20}):(0,r.jsx)(x.Z,{size:20})}),(0,r.jsx)("button",{type:"submit",disabled:a||!c.trim()&&!d,className:"btn-primary",children:(0,r.jsx)(p.Z,{size:20})})]})]})}var g=a(3539),f=a(6264);function ChatContainer(){let[e,t]=(0,s.useState)([{id:"1",content:"Hello! I'm SUARA, your customer service assistant brought to you by Team Codezilla. How can I assist you today?",sender:"bot",timestamp:new Date,type:"text"}]),[a,o]=(0,s.useState)(!1),[i,n]=(0,s.useState)(!1),[c,l]=(0,s.useState)(null),d=(0,s.useRef)(null),u=(0,s.useRef)(null),m=(0,s.useRef)([]),scrollToBottom=()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{scrollToBottom()},[e]);let[h,x]=(0,s.useState)(""),executeAction=async e=>{if(!c){console.error("No session ID available for action execution");return}o(!0),x("Executing action...");try{var a;let r=await ApiClient.executeAction(c,e);if(r.error)throw Error(r.error);let s={id:Date.now().toString(),content:'Action "'.concat(e,'" executed successfully. ').concat((null===(a=r.data)||void 0===a?void 0:a.message)||""),sender:"bot",timestamp:new Date,type:"text"};t(e=>[...e,s])}catch(r){console.error("Action execution error:",r);let a={id:Date.now().toString(),content:'Failed to execute action "'.concat(e,'": ').concat(r instanceof Error?r.message:"Unknown error"),sender:"bot",timestamp:new Date,type:"text"};t(e=>[...e,a])}finally{o(!1),x("")}},processWithBackend=async(e,a,r)=>{try{let s=1,o=(r?1:0)+(a?1:0)+1;if(r){x("Step ".concat(s,"/").concat(o,": Transcribing audio..."));let t=await ApiClient.transcribeAudio(e);if(t.error)throw Error("Transcription failed: ".concat(t.error));s++}if(a){x("Step ".concat(s,"/").concat(o,": Analyzing image..."));let t=await ApiClient.analyzeImage(e);if(t.error)throw Error("Image analysis failed: ".concat(t.error));s++}x("Step ".concat(s,"/").concat(o,": Generating solution..."));let i=await ApiClient.troubleshoot(e);if(i.error)throw Error("Troubleshooting failed: ".concat(i.error));let n=i.data,c={id:(Date.now()+1).toString(),content:n.response,sender:"bot",timestamp:new Date,type:"text",audioResponse:n.audio_url,sessionId:n.session_id,actions:n.actions};t(e=>[...e,c]),x("")}catch(a){console.error("Backend processing error:",a),x("");let e={id:(Date.now()+1).toString(),content:"I encountered an error: ".concat(a instanceof Error?a.message:"Unknown error",". Please try again or contact support."),sender:"bot",timestamp:new Date,type:"text"};t(t=>[...t,e])}},handleSendMessage=async(e,a,r)=>{let s={id:Date.now().toString(),content:e,sender:"user",timestamp:new Date,type:a,imageUrl:r&&"image"===a?URL.createObjectURL(r):void 0};t(e=>[...e,s]),o(!0);try{x("Uploading files...");let e=await ApiClient.uploadFiles("image"===a?r:void 0,"audio"===a?r:void 0);if(e.error)throw Error("Upload failed: ".concat(e.error));let t=e.data.session_id;l(t),await processWithBackend(t,"image"===a,"audio"===a)}catch(a){console.error("Error sending message:",a),x("");let e={id:(Date.now()+2).toString(),content:"Sorry, I encountered an error: ".concat(a instanceof Error?a.message:"Unknown error",". Please try again."),sender:"bot",timestamp:new Date,type:"text"};t(t=>[...t,e])}finally{o(!1),x("")}},startRecording=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(e);u.current=a,m.current=[],a.ondataavailable=e=>{m.current.push(e.data)},a.onstop=()=>{let a=new Blob(m.current,{type:"audio/wav"}),r=URL.createObjectURL(a),s={id:Date.now().toString(),content:"Audio message describing the issue",sender:"user",timestamp:new Date,type:"audio",audioUrl:r};t(e=>[...e,s]),handleSendMessage("Audio message describing the issue","audio",a),e.getTracks().forEach(e=>e.stop())},a.start(),n(!0)}catch(e){console.error("Error starting recording:",e)}};return(0,r.jsxs)("div",{className:"flex flex-col h-screen max-w-4xl mx-auto bg-surface shadow-ios-xl rounded-ios-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"header-gradient text-white p-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center shadow-ios backdrop-blur-ios",children:(0,r.jsx)(g.Z,{size:24})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold tracking-tight",children:"SUARA"}),(0,r.jsx)("p",{className:"text-sm opacity-90 font-medium",children:"AI-Powered Customer Service"})]})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-background custom-scrollbar",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[e.map(e=>(0,r.jsx)(ChatMessage,{message:e,onActionClick:executeAction},e.id)),a&&(0,r.jsxs)("div",{className:"flex gap-3 mb-6 message-enter message-enter-active",children:[(0,r.jsx)("div",{className:"avatar-bot",children:(0,r.jsx)(f.Z,{size:16,className:"animate-spin text-primary-600"})}),(0,r.jsx)("div",{className:"chat-bubble chat-bubble-bot",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"typing-indicator",children:[(0,r.jsx)("div",{className:"typing-dot"}),(0,r.jsx)("div",{className:"typing-dot"}),(0,r.jsx)("div",{className:"typing-dot"})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-sm text-text-secondary font-medium",children:h||"Analyzing your issue..."}),h&&(0,r.jsx)("div",{className:"mt-2 w-32 bg-surface-200 rounded-full h-1.5",children:(0,r.jsx)("div",{className:"bg-primary-500 h-1.5 rounded-full animate-pulse",style:{width:"60%"}})})]})]})})]})]}),(0,r.jsx)("div",{ref:d})]}),(0,r.jsx)("div",{className:"border-t border-surface-200 bg-surface/50 backdrop-blur-ios",children:(0,r.jsx)(ChatInput,{onSendMessage:handleSendMessage,isLoading:a,isRecording:i,onStartRecording:startRecording,onStopRecording:()=>{u.current&&i&&(u.current.stop(),n(!1))}})})]})}}},function(e){e.O(0,[734,971,472,744],function(){return e(e.s=8080)}),_N_E=e.O()}]);