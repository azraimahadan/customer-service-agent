(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8080:function(e,t,s){Promise.resolve().then(s.bind(s,634))},634:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ChatContainer}});var a=s(7437),r=s(2265),i=s(2601);let ApiClient=class ApiClient{static async uploadFiles(e,t){try{let s=new FormData;e&&s.append("image",e),t&&s.append("audio",t,"recording.wav");let a=await fetch("".concat(this.BASE_URL,"/api/upload"),{method:"POST",body:s});if(!a.ok)throw Error("Upload failed: ".concat(a.statusText));let r=await a.json();return{data:r}}catch(e){return console.error("Upload error:",e),{error:e instanceof Error?e.message:"Upload failed"}}}static async transcribeAudio(e){try{let t=await fetch("".concat(this.BASE_URL,"/api/transcribe"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})});if(!t.ok)throw Error("Transcription failed: ".concat(t.statusText));let s=await t.json();return{data:s}}catch(e){return console.error("Transcription error:",e),{error:e instanceof Error?e.message:"Transcription failed"}}}static async analyzeImage(e){try{let t=await fetch("".concat(this.BASE_URL,"/api/analyze-image"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})});if(!t.ok)throw Error("Image analysis failed: ".concat(t.statusText));let s=await t.json();return{data:s}}catch(e){return console.error("Image analysis error:",e),{error:e instanceof Error?e.message:"Image analysis failed"}}}static async troubleshoot(e){try{let t=await fetch("".concat(this.BASE_URL,"/api/troubleshoot"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})});if(!t.ok)throw Error("Troubleshooting failed: ".concat(t.statusText));let s=await t.json();return{data:s}}catch(e){return console.error("Troubleshooting error:",e),{error:e instanceof Error?e.message:"Troubleshooting failed"}}}};ApiClient.BASE_URL=i.env.NEXT_PUBLIC_API_URL||"http://localhost:8000";var o=s(7972),n=s(3966),l=s(1243),c=s(6691),d=s.n(c);function ChatMessage(e){let{message:t}=e,s="user"===t.sender;return(0,a.jsxs)("div",{className:"flex gap-3 ".concat(s?"flex-row-reverse":"flex-row"," mb-6 message-enter message-enter-active"),children:[(0,a.jsx)("div",{className:s?"avatar":"avatar-bot",children:s?(0,a.jsx)(o.Z,{size:18}):(0,a.jsx)(n.Z,{size:18})}),(0,a.jsxs)("div",{className:"chat-bubble ".concat(s?"chat-bubble-user":"chat-bubble-bot"),children:["text"===t.type&&(0,a.jsx)("p",{className:"text-base leading-relaxed font-medium",children:t.content}),"image"===t.type&&t.imageUrl&&(0,a.jsxs)("div",{children:[(0,a.jsx)(d(),{src:t.imageUrl,alt:"Uploaded image",width:240,height:240,className:"rounded-ios mb-3 shadow-ios-md border border-surface-200"}),t.content&&(0,a.jsx)("p",{className:"text-base leading-relaxed font-medium",children:t.content})]}),"audio"===t.type&&t.audioUrl&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-10 h-10 bg-primary-50 rounded-full",children:(0,a.jsx)(l.Z,{size:16,className:"text-primary-600"})}),(0,a.jsx)("audio",{controls:!0,className:"flex-1 h-8",children:(0,a.jsx)("source",{src:t.audioUrl,type:"audio/wav"})})]}),t.audioResponse&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-surface-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(l.Z,{size:14,className:"text-secondary-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Audio Response"})]}),(0,a.jsx)("audio",{controls:!0,className:"w-full h-8",children:(0,a.jsx)("source",{src:t.audioResponse,type:"audio/mpeg"})})]}),(0,a.jsx)("div",{className:"text-xs mt-2 font-medium ".concat(s?"text-white/80":"text-text-muted"),children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}var u=s(2549),m=s(4035),h=s(7803),p=s(4043),x=s(6020);function ChatInput(e){let{onSendMessage:t,isLoading:s,isRecording:i,onStartRecording:o,onStopRecording:n}=e,[l,c]=(0,r.useState)(""),[d,g]=(0,r.useState)(null),[b,f]=(0,r.useState)(null),y=(0,r.useRef)(null),handleSubmit=e=>{e.preventDefault(),(l.trim()||d)&&(d?(t(l,"image",d),g(null),f(null)):t(l,"text"),c(""))};return(0,a.jsxs)("div",{className:"p-6",children:[b&&(0,a.jsxs)("div",{className:"mb-4 relative inline-block",children:[(0,a.jsx)("img",{src:b,alt:"Preview",className:"max-w-24 max-h-24 rounded-ios shadow-ios-md border border-surface-200"}),(0,a.jsx)("button",{onClick:()=>{g(null),f(null),y.current&&(y.current.value="")},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-ios active:scale-95 transition-all",children:(0,a.jsx)(u.Z,{size:12})})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"flex gap-3 items-end",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"Ask about your issue...",className:"input-field resize-none min-h-[44px] max-h-32",rows:1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleSubmit(e))}})}),(0,a.jsx)("input",{ref:y,type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){g(s);let e=new FileReader;e.onload=e=>{var t;return f(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(s)}},className:"hidden"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=y.current)||void 0===e?void 0:e.click()},className:"btn-icon",disabled:s,children:(0,a.jsx)(m.Z,{size:20})}),(0,a.jsx)("button",{type:"button",onClick:i?n:o,className:"btn-icon ".concat(i?"bg-red-50 text-red-600 border-red-200 animate-pulse":""),disabled:s,children:i?(0,a.jsx)(h.Z,{size:20}):(0,a.jsx)(p.Z,{size:20})}),(0,a.jsx)("button",{type:"submit",disabled:s||!l.trim()&&!d,className:"btn-primary",children:(0,a.jsx)(x.Z,{size:20})})]})]})}var g=s(3539),b=s(6264);function ChatContainer(){let[e,t]=(0,r.useState)([{id:"1",content:"Hello! I'm SUARA, your customer service assistant brought to you by Team Codezilla. How can I assist you today?",sender:"bot",timestamp:new Date,type:"text"}]),[s,i]=(0,r.useState)(!1),[o,n]=(0,r.useState)(!1),[l,c]=(0,r.useState)(null),d=(0,r.useRef)(null),u=(0,r.useRef)(null),m=(0,r.useRef)([]),scrollToBottom=()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{scrollToBottom()},[e]);let processWithBackend=async(e,s,a)=>{try{a&&await ApiClient.transcribeAudio(e),s&&await ApiClient.analyzeImage(e);let r=await ApiClient.troubleshoot(e);if(r.error)throw Error(r.error);let i=r.data,o={id:(Date.now()+1).toString(),content:i.response,sender:"bot",timestamp:new Date,type:"text",audioResponse:i.audio_url,sessionId:i.session_id,actions:i.actions};t(e=>[...e,o])}catch(s){console.error("Backend processing error:",s);let e={id:(Date.now()+1).toString(),content:"I'm having trouble processing your request right now. Please try again or contact support if the issue persists.",sender:"bot",timestamp:new Date,type:"text"};t(t=>[...t,e])}},handleSendMessage=async(e,s,a)=>{let r={id:Date.now().toString(),content:e,sender:"user",timestamp:new Date,type:s,imageUrl:a&&"image"===s?URL.createObjectURL(a):void 0};t(e=>[...e,r]),i(!0);try{if("text"!==s||a){let e=await ApiClient.uploadFiles("image"===s?a:void 0,"audio"===s?a:void 0);if(e.error)throw Error(e.error);let t=e.data.session_id;c(t),await processWithBackend(t,"image"===s,"audio"===s)}else{let e={id:(Date.now()+1).toString(),content:"I understand you have a question about your Unifi TV service. For the most accurate troubleshooting, please share a photo of any error messages on your screen or record an audio description of the issue you're experiencing.",sender:"bot",timestamp:new Date,type:"text"};t(t=>[...t,e])}}catch(s){console.error("Error sending message:",s);let e={id:(Date.now()+2).toString(),content:"Sorry, I encountered an error processing your request. Please try again.",sender:"bot",timestamp:new Date,type:"text"};t(t=>[...t,e])}finally{i(!1)}},startRecording=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e);u.current=s,m.current=[],s.ondataavailable=e=>{m.current.push(e.data)},s.onstop=()=>{let s=new Blob(m.current,{type:"audio/wav"}),a=URL.createObjectURL(s),r={id:Date.now().toString(),content:"Audio message describing the issue",sender:"user",timestamp:new Date,type:"audio",audioUrl:a};t(e=>[...e,r]),handleSendMessage("Audio message describing the issue","audio",s),e.getTracks().forEach(e=>e.stop())},s.start(),n(!0)}catch(e){console.error("Error starting recording:",e)}};return(0,a.jsxs)("div",{className:"flex flex-col h-screen max-w-4xl mx-auto bg-surface shadow-ios-xl rounded-ios-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"header-gradient text-white p-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center shadow-ios backdrop-blur-ios",children:(0,a.jsx)(g.Z,{size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold tracking-tight",children:"SUARA"}),(0,a.jsx)("p",{className:"text-sm opacity-90 font-medium",children:"AI-Powered Customer Service"})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-background custom-scrollbar",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[e.map(e=>(0,a.jsx)(ChatMessage,{message:e},e.id)),s&&(0,a.jsxs)("div",{className:"flex gap-3 mb-6 message-enter message-enter-active",children:[(0,a.jsx)("div",{className:"avatar-bot",children:(0,a.jsx)(b.Z,{size:16,className:"animate-spin text-primary-600"})}),(0,a.jsx)("div",{className:"chat-bubble chat-bubble-bot",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"typing-indicator",children:[(0,a.jsx)("div",{className:"typing-dot"}),(0,a.jsx)("div",{className:"typing-dot"}),(0,a.jsx)("div",{className:"typing-dot"})]}),(0,a.jsx)("span",{className:"text-sm text-text-secondary font-medium",children:"Analyzing your issue..."})]})})]})]}),(0,a.jsx)("div",{ref:d})]}),(0,a.jsx)("div",{className:"border-t border-surface-200 bg-surface/50 backdrop-blur-ios",children:(0,a.jsx)(ChatInput,{onSendMessage:handleSendMessage,isLoading:s,isRecording:o,onStartRecording:startRecording,onStopRecording:()=>{u.current&&o&&(u.current.stop(),n(!1))}})})]})}}},function(e){e.O(0,[734,971,472,744],function(){return e(e.s=8080)}),_N_E=e.O()}]);